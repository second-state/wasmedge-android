(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(9974)}])},9974:function(e,t,l){"use strict";l.r(t),l.d(t,{__N_SSG:function(){return e3},default:function(){return e4}});var r,a,s=l(85893),n=l(67294),i=l(61162),o=l(9008),d=l.n(o);let c=e=>{let{initialState:t}=e,l=(e,l)=>{if(!l.type)return{...e,[l.field]:l.value};if("reset"===l.type)return t;throw Error()},[r,a]=(0,n.useReducer)(l,t);return(0,n.useMemo)(()=>({state:r,dispatch:a}),[r,a])};var u=l(11163),m=l(83454);let x=()=>{let e=async e=>{let t="".concat(e.url,"/v1/models");try{let l=await fetch(t,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.key?e.key:m.env.NEXT_PUBLIC_OPENAI_API_KEY)}}),r=await l.json(),a=r.data;if(a&&a.length>0)return a.map(e=>(-1===e.id.indexOf(":")||e.name||(e.name=e.id.split(":")[1],e.id=e.id.split(":")[0]),e));return[]}catch(e){return{}}};return{getModels:e}};(r=a||(a={})).GPT_3_5="gpt-3.5-turbo",r.LLAMA_2_CHAT="llama-2-chat",r.GPT_3_5_AZ="gpt-35-turbo",r.GPT_4="gpt-4",r.GPT_4_32K="gpt-4-32k",a.LLAMA_2_CHAT;let p={[a.GPT_3_5]:{id:a.GPT_3_5,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[a.LLAMA_2_CHAT]:{id:a.LLAMA_2_CHAT,name:"LLAMA_2_CHAT",maxLength:12e3,tokenLimit:4e3},[a.GPT_3_5_AZ]:{id:a.GPT_3_5_AZ,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[a.GPT_4]:{id:a.GPT_4,name:"GPT-4",maxLength:24e3,tokenLimit:8e3},[a.GPT_4_32K]:{id:a.GPT_4_32K,name:"GPT-4-32K",maxLength:96e3,tokenLimit:32e3}};var h=l(83454);h.env.NEXT_PUBLIC_DEFAULT_SYSTEM_PROMPT,h.env.OPENAI_API_HOST;let g=parseFloat(h.env.NEXT_PUBLIC_DEFAULT_TEMPERATURE||"1");h.env.OPENAI_API_TYPE,h.env.OPENAI_API_VERSION,h.env.OPENAI_ORGANIZATION,h.env.AZURE_DEPLOYMENT_ID;let v=e=>{let t=e;return t.model||(t={...t,model:t.model||p[a.GPT_3_5]}),t.temperature||(t={...t,temperature:t.temperature||g}),t.folderId||(t={...t,folderId:t.folderId||null}),t.messages||(t={...t,messages:t.messages||[]}),t},f=e=>Array.isArray(e)?e.reduce((e,t)=>{try{t.model||(t.model=p[a.GPT_3_5]),t.temperature||(t.temperature=g),t.folderId||(t.folderId=null),t.messages||(t.messages=[]),e.push(t)}catch(e){console.warn("error while cleaning conversations' history. Removing culprit",e)}return e},[]):(console.warn("history is not an array. Returning an empty array."),[]),b=(e,t)=>{let l=t.map(t=>t.id===e.id?e:t);return y(e),w(l),{single:e,all:l}},y=e=>{localStorage.setItem("selectedConversation",JSON.stringify(e))},w=e=>{localStorage.setItem("conversationHistory",JSON.stringify(e))},j=e=>{localStorage.setItem("folders",JSON.stringify(e))},k=e=>{localStorage.setItem("prompts",JSON.stringify(e))},N="settings",C=()=>{let e={theme:"dark",isStream:!0},t=localStorage.getItem(N);if(t)try{let l=JSON.parse(t);e=Object.assign(e,l)}catch(e){console.error(e)}return e},S=e=>{localStorage.setItem(N,JSON.stringify(e))};var I=l(33111),_=l(51668);let L=(0,n.createContext)(void 0);var E=l(30904),P=l(20487),A=l(59348),T=l(23461),z=l(63072);let O=e=>{let{prompts:t,activePromptIndex:l,onSelect:r,onMouseOver:a,promptListRef:n}=e;return(0,s.jsx)("ul",{ref:n,className:"z-10 max-h-52 w-full overflow-scroll rounded border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-neutral-500 dark:bg-[#343541] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)]",children:t.map((e,t)=>(0,s.jsx)("li",{className:"".concat(t===l?"bg-gray-200 dark:bg-[#202123] dark:text-black":""," cursor-pointer px-3 py-2 text-sm text-black dark:text-white"),onClick:e=>{e.preventDefault(),e.stopPropagation(),r()},onMouseEnter:()=>a(t),children:e.name},e.id))})},Z=e=>{let{prompt:t,variables:l,onSubmit:r,onClose:a}=e,[i,o]=(0,n.useState)(l.map(e=>({key:e,value:""})).filter((e,t,l)=>l.findIndex(t=>t.key===e.key)===t)),d=(0,n.useRef)(null),c=(0,n.useRef)(null),u=(e,t)=>{o(l=>{let r=[...l];return r[e].value=t,r})},m=()=>{if(i.some(e=>""===e.value)){alert("Please fill out all variables");return}r(i.map(e=>e.value)),a()},x=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&a():(e.preventDefault(),m())};return(0,n.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&a()};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[a]),(0,n.useEffect)(()=>{c.current&&c.current.focus()},[]),(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onKeyDown:x,children:(0,s.jsxs)("div",{ref:d,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,s.jsx)("div",{className:"mb-4 text-xl font-bold text-black dark:text-neutral-200",children:t.name}),(0,s.jsx)("div",{className:"mb-4 text-sm italic text-black dark:text-neutral-200",children:t.description}),i.map((e,t)=>(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("div",{className:"mb-2 text-sm font-bold text-neutral-200",children:e.key}),(0,s.jsx)("textarea",{ref:0===t?c:void 0,className:"mt-1 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:"Enter a value for ".concat(e.key,"..."),value:e.value,onChange:e=>u(t,e.target.value),rows:3})]},t)),(0,s.jsx)("button",{className:"mt-6 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:m,children:"Submit"})]})})},D=e=>{var t;let{onSend:l,onRegenerate:r,maxImg:a,onScrollDownClick:o,stopConversationRef:d,textareaRef:c,showScrollDownButton:u}=e,{t:m}=(0,i.$G)("chat"),{state:{selectedConversation:x,messageIsStreaming:p,prompts:h,controller:g},dispatch:v}=(0,n.useContext)(L),[f,b]=(0,n.useState)(),[y,w]=(0,n.useState)(!1),[j,k]=(0,n.useState)(!1),[N,C]=(0,n.useState)(0),[S,I]=(0,n.useState)(""),[_,D]=(0,n.useState)([]),[R,K]=(0,n.useState)(!1),[G,M]=(0,n.useState)(!1),[J,U]=(0,n.useState)(null),[H,F]=(0,n.useState)(!1),[B,$]=(0,n.useState)(""),Y=(0,n.useRef)(null),q=h.filter(e=>e.name.toLowerCase().includes(S.toLowerCase())),W=e=>{let t=e.target.value,l=null==x?void 0:x.model.maxLength;if(l&&t.length>l){alert(m("Message limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:l,valueLength:t.length}));return}b(t),er(t)},X=()=>{p&&g&&(g.abort(),v({field:"messageIsStreaming",value:!1}))},V=()=>{let e=en;if(H&&(e=eu()),p)return;if(!f){alert(m("Please enter a message"));return}let t=f;e.length>0&&(t=[{type:"text",text:f}],e.forEach(e=>{Array.isArray(t)&&t.push({type:"image_url",image_url:{url:e}})})),l({role:"user",content:t},J),b(""),ei([]),U(null),window.innerWidth<640&&c&&c.current&&c.current.blur()},Q=()=>{let e=void 0===window.navigator?"":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},ee=()=>{let e=q[N];e&&(b(t=>null==t?void 0:t.replace(/\/\w*$/,e.content)),ea(e)),k(!1)},et=e=>{j?"ArrowDown"===e.key?(e.preventDefault(),C(e=>e<h.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),C(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),C(e=>e<h.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),ee()):"Escape"===e.key?(e.preventDefault(),k(!1)):C(0):"Enter"!==e.key||y||Q()||e.shiftKey?"/"===e.key&&e.metaKey&&(e.preventDefault(),M(!G)):(e.preventDefault(),V())},el=e=>{let t;let l=/{{(.*?)}}/g,r=[];for(;null!==(t=l.exec(e));)r.push(t[1]);return r},er=(0,n.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(k(!0),I(t[0].slice(1))):(k(!1),I(""))},[]),ea=e=>{let t=el(e.content);D(t),t.length>0?K(!0):(b(t=>null==t?void 0:t.replace(/\/\w*$/,e.content)),er(e.content))},es=e=>{let t=null==f?void 0:f.replace(/{{(.*?)}}/g,(t,l)=>{let r=_.indexOf(l);return e[r]});b(t),c&&c.current&&c.current.focus()};(0,n.useEffect)(()=>{Y.current&&(Y.current.scrollTop=30*N)},[N]),(0,n.useEffect)(()=>{if(c&&c.current){var e,t;c.current.style.height="inherit",c.current.style.height="".concat(null===(e=c.current)||void 0===e?void 0:e.scrollHeight,"px"),c.current.style.overflow="".concat((null==c?void 0:null===(t=c.current)||void 0===t?void 0:t.scrollHeight)>400?"auto":"hidden")}},[f]),(0,n.useEffect)(()=>{let e=e=>{Y.current&&!Y.current.contains(e.target)&&k(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]);let[en,ei]=(0,n.useState)([]),eo=e=>{let t=e.target.files;if(t){let e=[],l=[];for(let r=0;r<t.length;r++){let a=t[r],s=new FileReader;l.push(new Promise(t=>{s.onloadend=()=>{e.push(s.result),t()}})),s.readAsDataURL(a)}Promise.all(l).then(()=>{ed(e)})}},ed=e=>{let t;if(en.length+e.length<=a)t=[...en,...e];else{let l=[...e,...e];t=l.slice(-a)}return ei(t),t},ec=e=>{ei(t=>{let l=[...t];return l.splice(e,1),l})},eu=()=>{let e=[];return F(!1),B&&(e=ed([B]),$("")),e};return(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 w-full border-transparent bg-gradient-to-b from-transparent via-white to-white pt-6 dark:border-white/20 dark:via-[#343541] dark:to-[#343541] md:pt-2",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:eo,style:{display:"none"},id:"upload-button"}),(0,s.jsx)("div",{className:"lg:mx-auto lg:max-w-3xl mx-2 md:mx-4 mt-4 md:mt-[52px] ",children:(0,s.jsx)("div",{className:"flex justify-start"+(en.length>0?" mt-4":""),children:(0,s.jsxs)("div",{className:"text-black flex items-center p-2 mx-2 sm:mx-4 w-full rounded-t-md bg-white border-black/10 dark:text-white dark:border-gray-900/50 dark:bg-[#40414f] border-t border-x",children:[(0,s.jsx)("button",{title:"upload image file",disabled:0===a,className:"p-2 mr-2 bg-[#ececec] dark:bg-[#343541] rounded-lg"+(0===a?" cursor-not-allowed":""),onClick:()=>{var e;null===(e=document.getElementById("upload-button"))||void 0===e||e.click()},children:(0,s.jsx)(E.Z,{size:20})}),H?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{onChange:e=>{$(e.target.value)},id:"imgUrlInputBox",autoFocus:!0,style:{height:"2.25rem"},className:"px-2 h-full bg-[#ececec] dark:bg-[#343541] rounded-l-lg"}),(0,s.jsx)("button",{title:"upload",className:"p-2 bg-[#ececec] dark:bg-[#343541] rounded-r-lg",onClick:eu,children:B?"Submit":"Close"})]}):(0,s.jsx)("button",{disabled:0===a,title:"Upload images by entering the url",className:"p-2 bg-[#ececec] dark:bg-[#343541] rounded-lg"+(0===a?" cursor-not-allowed":""),onClick:()=>{F(!0)},children:(0,s.jsx)(P.Z,{size:20})}),(0,s.jsx)("div",{className:"ml-4 "+(0===a?"hidden":"block"),children:"For Llava series models, please submit an image URL or upload an image."})]})})}),(0,s.jsx)("div",{className:"stretch mx-2 flex flex-row gap-3 last:mb-2 md:mx-4 md:last:mb-6 lg:mx-auto lg:max-w-3xl",children:(0,s.jsxs)("div",{className:"relative mx-2 flex w-full flex-grow flex-col rounded-b-md border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-gray-900/50 dark:bg-[#40414F] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] sm:mx-4",children:[(0,s.jsx)("div",{className:"absolute left-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 dark:bg-opacity-50 dark:text-neutral-100",children:(0,s.jsx)(A.Z,{size:20})}),(0,s.jsx)("textarea",{ref:c,className:"m-0 w-full resize-none border-0 bg-transparent p-0 py-2 pr-8 pl-10 text-black dark:bg-transparent dark:text-white md:py-3 md:pl-10",style:{resize:"none",bottom:"".concat(null==c?void 0:null===(t=c.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"400px",overflow:"".concat(c.current&&c.current.scrollHeight>400?"auto":"hidden")},placeholder:m('Type a message or type "/" to select a prompt...')||"",value:f,rows:1,onCompositionStart:()=>w(!0),onCompositionEnd:()=>w(!1),onChange:W,onKeyDown:et}),(0,s.jsx)("button",{className:"absolute right-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:p?X:V,children:p?(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",className:"icon icon-tabler icons-tabler-filled icon-tabler-circle-rectangle",children:[(0,s.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),(0,s.jsx)("path",{d:"M17 3.34a10 10 0 1 1 -15 8.66l.005 -.324a10 10 0 0 1 14.995 -8.336m0 5.66h-10a1 1 0 0 0 -1 1v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1 -1v-4a1 1 0 0 0 -1 -1"})]}):(0,s.jsx)(T.Z,{size:18})}),u&&(0,s.jsx)("div",{className:"absolute bottom-12 right-0 lg:bottom-0 lg:-right-10",children:(0,s.jsx)("button",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-neutral-300 text-gray-800 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-neutral-200",onClick:o,children:(0,s.jsx)(z.Z,{size:18})})}),j&&q.length>0&&(0,s.jsx)("div",{className:"absolute bottom-12 w-full",children:(0,s.jsx)(O,{activePromptIndex:N,prompts:q,onSelect:ee,onMouseOver:C,promptListRef:Y})}),R&&(0,s.jsx)(Z,{prompt:q[N],variables:_,onSubmit:es,onClose:()=>K(!1)})]})}),(0,s.jsx)("div",{className:"lg:mx-auto lg:max-w-3xl",children:(0,s.jsx)("div",{className:"flex mx-2 sm:mx-4"+(en.length>0?" mt-4":""),children:en.map((e,t)=>(0,s.jsx)("div",{style:{position:"relative",display:"inline-block",marginRight:"10px"},children:(0,s.jsxs)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",position:"relative"},children:[(0,s.jsx)("img",{src:e,alt:"Uploaded",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,s.jsx)("div",{style:{position:"absolute",top:"5px",right:"5px",cursor:"pointer"},onClick:()=>ec(t),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-circle",viewBox:"0 0 16 16",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zM7.354 8l-2.88 2.879a.5.5 0 0 1-.708-.708L6.646 8 3.766 5.121a.5.5 0 0 1 .708-.708L8 7.354l2.879-2.88a.5.5 0 0 1 .708.708L8.354 8l2.879 2.879a.5.5 0 0 1-.708.708L8 8.354 5.121 11.233a.5.5 0 0 1-.708-.708L7.354 8z"})})})]})},t))})}),(0,s.jsxs)("div",{className:"px-3 pt-2 pb-3 text-center text-[12px] text-black/50 dark:text-white/50 md:px-4 md:pt-3 md:pb-6",children:[(0,s.jsx)("span",{children:"Based on "}),(0,s.jsx)("a",{href:"https://github.com/second-state/chatbot-ui",target:"_blank",rel:"noreferrer",className:"underline",children:"chatbot-ui"})]})]})};var R=l(90553);let K=()=>(0,s.jsx)("div",{className:"group border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100",style:{overflowWrap:"anywhere"},children:(0,s.jsxs)("div",{className:"m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,s.jsx)("div",{className:"min-w-[40px] items-end",children:(0,s.jsx)(R.Z,{size:30})}),(0,s.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"})]})}),G=e=>{let{size:t="1em",className:l=""}=e;return(0,s.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin ".concat(l),height:t,width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,s.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,s.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,s.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,s.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,s.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,s.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,s.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})};var M=l(58403);let J=e=>{let{error:t}=e;return(0,s.jsxs)("div",{className:"mx-6 flex h-full flex-col items-center justify-center text-red-500",children:[(0,s.jsx)("div",{className:"mb-5",children:(0,s.jsx)(M.Z,{size:36})}),(0,s.jsx)("div",{className:"mb-3 text-2xl font-medium",children:t.title}),t.messageLines.map((e,t)=>(0,s.jsxs)("div",{className:"text-center",children:[" ",e," "]},t)),(0,s.jsx)("div",{className:"mt-4 text-xs opacity-50 dark:text-red-400",children:t.code?(0,s.jsxs)("i",{children:["Code: ",t.code]}):""})]})},U=[{id:"llama-2-chat",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"codellama-instruct",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"vicuna-chat",description:"",content:"You are a helpful, respectful and honest assistant. Always answer as short as possible, while being safe.",controlState:0},{id:"chatml",description:"",content:"Answer as concisely as possible.",controlState:1},{id:"mistral-instruct-v0.1",description:"",content:"",controlState:2},{id:"belle-llama-2-chat",description:"",content:"",controlState:2}],H=()=>{var e;let{t}=(0,i.$G)("chat"),{state:{selectedConversation:l,models:r,defaultModelId:a},handleUpdateConversationAll:o,dispatch:d}=(0,n.useContext)(L);return(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:t("Model")}),(0,s.jsx)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,s.jsx)("div",{className:"w-full p-2",children:(null==l?void 0:null===(e=l.model)||void 0===e?void 0:e.id)||a})})]})},F=e=>{var t;let{conversation:l,prompts:r,onChangePrompt:a}=e,{t:o}=(0,i.$G)("chat"),[d,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(0),[x,p]=(0,n.useState)(!1),[h,g]=(0,n.useState)(""),[v,f]=(0,n.useState)([]),[b,y]=(0,n.useState)(!1),w=(0,n.useRef)(null),j=(0,n.useRef)(null),k=r.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())),N=e=>{let t=e.target.value,r=l.model.maxLength;if(t.length>r){alert(o("Prompt limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:r,valueLength:t.length}));return}c(t),I(t),a(t)},C=()=>{let e=k[u];c(t=>{let l=null==t?void 0:t.replace(/\/\w*$/,e.content);return l}),_(e),p(!1)},S=e=>{let t;let l=/{{(.*?)}}/g,r=[];for(;null!==(t=l.exec(e));)r.push(t[1]);return r},I=(0,n.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(p(!0),g(t[0].slice(1))):(p(!1),g(""))},[]),_=e=>{let t=S(e.content);if(f(t),t.length>0)y(!0);else{let t=null==d?void 0:d.replace(/\/\w*$/,e.content);c(t),a(t),I(e.content)}},L=e=>{let t=null==d?void 0:d.replace(/{{(.*?)}}/g,(t,l)=>{let r=v.indexOf(l);return e[r]});c(t),a(t),w&&w.current&&w.current.focus()},E=e=>{x&&("ArrowDown"===e.key?(e.preventDefault(),m(e=>e<r.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),m(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),m(e=>e<r.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),C()):"Escape"===e.key?(e.preventDefault(),p(!1)):m(0))};return(0,n.useEffect)(()=>{if(w&&w.current){var e;w.current.style.height="inherit",w.current.style.height="".concat(null===(e=w.current)||void 0===e?void 0:e.scrollHeight,"px")}},[d]),(0,n.useEffect)(()=>{c(l.prompt||"")},[l.prompt]),(0,n.useEffect)(()=>{let e=e=>{j.current&&!j.current.contains(e.target)&&p(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:o("System Prompt")}),(0,s.jsx)("textarea",{ref:w,className:"w-full rounded-lg border border-neutral-200 bg-transparent px-4 py-3 text-neutral-900 dark:border-neutral-600 dark:text-neutral-100",style:{borderColor:"".concat(d||1!==l.promptState?"":"red"),resize:"none",bottom:"".concat(null==w?void 0:null===(t=w.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"300px",overflow:"".concat(w.current&&w.current.scrollHeight>400?"auto":"hidden")},placeholder:o('Enter a prompt or type "/" to select a prompt...')||"",value:d||"",rows:1,onChange:N,onKeyDown:E}),!d&&1===l.promptState&&(0,s.jsx)("div",{style:{color:"red",marginTop:"2px"},children:"The prompt of this model cannot be empty!"}),x&&k.length>0&&(0,s.jsx)("div",{children:(0,s.jsx)(O,{activePromptIndex:u,prompts:k,onSelect:C,onMouseOver:m,promptListRef:j})}),b&&(0,s.jsx)(Z,{prompt:r[u],variables:v,onSubmit:L,onClose:()=>y(!1)})]})};var B=l(8861),$=l(21942),Y=l(74075),q=l(24888),W=l(88198),X=l(93625),V=l(67828),Q=l(80335),ee=l(93179),et=l(84283);let el={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},er=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l="ABCDEFGHJKLMNPQRSTUVWXY3456789",r="";for(let t=0;t<e;t++)r+=l.charAt(Math.floor(Math.random()*l.length));return t?r.toLowerCase():r},ea=(0,n.memo)(e=>{let{language:t,value:l}=e,{t:r}=(0,i.$G)("markdown"),[a,o]=(0,n.useState)(!1),d=()=>{navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(l).then(()=>{o(!0),setTimeout(()=>{o(!1)},2e3)})},c=()=>{let e=el[t]||".file",a="file-".concat(er(3,!0)).concat(e),s=window.prompt(r("Enter file name")||"",a);if(!s)return;let n=new Blob([l],{type:"text/plain"}),i=URL.createObjectURL(n),o=document.createElement("a");o.download=s,o.href=i,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)};return(0,s.jsxs)("div",{className:"codeblock relative font-sans text-[16px]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between py-1.5 px-4",children:[(0,s.jsx)("span",{className:"text-xs lowercase text-white",children:t}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("button",{className:"flex gap-1.5 items-center rounded bg-none p-1 text-xs text-white",onClick:d,children:[a?(0,s.jsx)(W.Z,{size:18}):(0,s.jsx)(V.Z,{size:18}),a?r("Copied!"):r("Copy code")]}),(0,s.jsx)("button",{className:"flex items-center rounded bg-none p-1 text-xs text-white",onClick:c,children:(0,s.jsx)(Q.Z,{size:18})})]})]}),(0,s.jsx)(ee.Z,{language:t,style:et.vk,customStyle:{margin:0},children:l})]})});ea.displayName="CodeBlock";var es=l(16202);let en=e=>{let{children:t}=e,l=[],r=0,a=t.match(/<\/think>/);if(a&&!t.slice(0,a.index).includes("<think>"))t.slice(0,a.index)&&""!==t.slice(0,a.index).trim()&&a.index>0&&l.push((0,s.jsx)("div",{className:"bg-gray-200 dark:bg-gray-600  p-4 my-2 rounded-lg border-l-4 border-gray-500 dark:border-gray-200",children:(0,s.jsx)(es.D,{children:t.slice(0,a.index)})},"think-start")),a.index+8<t.length&&l.push((0,s.jsx)(es.D,{children:t.slice(a.index+8)},"after-think"));else{let e;let a=/<think>([\s\S]*?)<\/think>/g;for(;null!==(e=a.exec(t));)e.index>r&&l.push((0,s.jsx)(es.D,{children:t.slice(r,e.index)},"text-".concat(r))),""!==e[1].trim()&&l.push((0,s.jsx)("div",{className:"bg-gray-200 dark:bg-gray-600 p-4 my-2 rounded-lg border-l-4 border-gray-500 dark:border-gray-200",children:(0,s.jsx)(es.D,{children:e[1]})},"think-".concat(e.index))),r=e.index+e[0].length;r<t.length&&l.push((0,s.jsx)(es.D,{children:t.slice(r)},"text-".concat(r)))}return(0,s.jsx)("div",{children:l})},ei=(0,n.memo)(e=>{let{children:t,...l}=e;return(0,s.jsx)(en,{...l,children:"string"==typeof t?t:""})},(e,t)=>e.children===t.children);ei.displayName="MemoizedReactMarkdown";var eo=l(45884),ed=l(29758),ec=l(30399);let eu=(0,n.memo)(e=>{var t;let{message:l,maxImg:r,messageIndex:a,onRegenerate:o,onEdit:d}=e,{t:c}=(0,i.$G)("chat"),{state:{selectedConversation:u,conversations:m,currentMessage:x,messageIsStreaming:p},dispatch:h}=(0,n.useContext)(L),[g,v]=(0,n.useState)(!1),[f,y]=(0,n.useState)(!1),[w,j]=(0,n.useState)(""),[k,N]=(0,n.useState)([]),[C,S]=(0,n.useState)(!1),I=(0,n.useRef)(null),_=()=>{v(!g)},E=e=>{j(e.target.value),I.current&&(I.current.style.height="inherit",I.current.style.height="".concat(I.current.scrollHeight,"px"))},P=()=>{let e=!1,t=!1,r=w,a=z(l.content);k.length>0?((0===a.imgList.length||k.length!==a.imgList.length)&&(t=!0),a.text!==w&&(e=!0),r=[{type:"text",text:w}],k.forEach((e,l)=>{t||e===a.imgList[l]||(t=!0),Array.isArray(r)&&r.push({type:"image_url",image_url:{url:e}})})):(a.imgList.length>0&&(t=!0),l.content!=w&&(e=!0)),(e||t)&&u&&d&&d({...l,content:r}),v(!1)},A=()=>{if(!u)return;let{messages:e}=u,t=e.findIndex(e=>e===l);if(t<0)return;t<e.length-1&&"assistant"===e[t+1].role?e.splice(t,2):e.splice(t,1);let r={...u,messages:e},{single:a,all:s}=b(r,m);h({field:"selectedConversation",value:a}),h({field:"conversations",value:s})},T=e=>{"Enter"!==e.key||f||e.shiftKey||(e.preventDefault(),P())},z=e=>{let t="",l=[];return Array.isArray(e)?e.forEach(e=>{"text"===e.type?t=e.text||"":"image_url"===e.type&&e.image_url&&l.push(e.image_url.url)}):t=e,{text:t,imgList:l}},O=()=>{navigator.clipboard&&navigator.clipboard.writeText(z(l.content).text).then(()=>{S(!0),setTimeout(()=>{S(!1)},2e3)})},Z=e=>{let t=z(e);N(t.imgList),j(t.text)};(0,n.useEffect)(()=>{Z(l.content)},[l.content]),(0,n.useEffect)(()=>{I.current&&(I.current.style.height="inherit",I.current.style.height="".concat(I.current.scrollHeight,"px"))},[g]);let D=e=>{k.length+e.length<=r?N(t=>[...t,...e]):N(t=>{let l=[...t,...e];return l.slice(-r)})},K=e=>{let t=e.target.files;if(t){let e=[],l=[];for(let r=0;r<t.length;r++){let a=t[r],s=new FileReader;l.push(new Promise(t=>{s.onloadend=()=>{e.push(s.result),t()}})),s.readAsDataURL(a)}Promise.all(l).then(()=>{D(e)})}},G=e=>{N(t=>{let l=[...t];return l.splice(e,1),l})};return(0,s.jsx)("div",{className:"group md:px-4 ".concat("assistant"===l.role?"border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100":"border-b border-black/10 bg-white text-gray-800 dark:border-gray-900/50 dark:bg-[#343541] dark:text-gray-100"),style:{overflowWrap:"anywhere"},children:(0,s.jsxs)("div",{className:"relative m-auto flex p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,s.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"assistant"===l.role?(0,s.jsx)(R.Z,{size:30}):(0,s.jsx)(B.Z,{size:30})}),(0,s.jsx)("div",{className:"prose mt-[-2px] w-full dark:prose-invert",children:"user"===l.role?(0,s.jsxs)("div",{className:"flex w-full",children:[g?(0,s.jsxs)("div",{className:"flex w-full flex-col",children:[(0,s.jsx)("textarea",{ref:I,className:"w-full resize-none whitespace-pre-wrap border-none dark:bg-[#343541]",value:w,onChange:E,onKeyDown:T,onCompositionStart:()=>y(!0),onCompositionEnd:()=>y(!1),style:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",padding:"0",margin:"0",overflow:"hidden"}}),(0,s.jsxs)("div",{className:"flex",children:[k.map((e,t)=>(0,s.jsx)("div",{style:{position:"relative",display:"inline-block",marginRight:"10px"},children:(0,s.jsxs)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",position:"relative"},children:[(0,s.jsx)("img",{src:e,alt:"Uploaded",className:"my-0",style:{width:"100%",height:"100%",objectFit:"cover"}}),(0,s.jsx)("div",{style:{position:"absolute",top:"5px",right:"5px",cursor:"pointer"},onClick:()=>G(t),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-x-circle",viewBox:"0 0 16 16",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zM7.354 8l-2.88 2.879a.5.5 0 0 1-.708-.708L6.646 8 3.766 5.121a.5.5 0 0 1 .708-.708L8 7.354l2.879-2.88a.5.5 0 0 1 .708.708L8.354 8l2.879 2.879a.5.5 0 0 1-.708.708L8 8.354 5.121 11.233a.5.5 0 0 1-.708-.708L7.354 8z"})})})]})},t)),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:K,style:{display:"none"},id:"upload-button"}),(0,s.jsx)("div",{style:{width:"100px",height:"100px",borderRadius:"5px",border:"1px dashed #ccc",overflow:"hidden",cursor:"pointer",textAlign:"center",lineHeight:"100px"},className:"flex justify-center items-center"+(k.length>=r?" hidden":""),onClick:()=>{var e;null===(e=document.getElementById("upload-button"))||void 0===e||e.click()},children:(0,s.jsx)("div",{className:"text-4xl",children:"+"})})]}),(0,s.jsxs)("div",{className:"mt-10 flex justify-center space-x-4",children:[(0,s.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:P,disabled:w.trim().length<=0,children:c("Save & Submit")}),(0,s.jsx)("button",{className:"h-[40px] rounded-md border border-neutral-300 px-4 py-1 text-sm font-medium text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",onClick:()=>{Z(l.content),v(!1)},children:c("Cancel")})]})]}):(0,s.jsxs)("div",{className:"prose whitespace-pre-wrap dark:prose-invert flex-1",children:[z(l.content).text,(0,s.jsx)("div",{className:"flex items-center",children:z(l.content).imgList.map((e,t)=>(0,s.jsx)("div",{style:{marginRight:"10px",flex:1},children:(0,s.jsx)("img",{src:e,alt:"Uploaded"})},t))})]}),!g&&(0,s.jsxs)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:[(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:_,children:(0,s.jsx)($.Z,{size:20})}),(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:A,children:(0,s.jsx)(Y.Z,{size:20})})]})]}):(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)(ei,{className:"prose dark:prose-invert flex-1",remarkPlugins:[ed.Z,ec.Z],rehypePlugins:[eo.Z],components:{code(e){let{node:t,inline:l,className:r,children:a,...n}=e;if(a.length){if("▍"==a[0])return(0,s.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"});a[0]=a[0].replace("`▍`","▍")}let i=/language-(\w+)/.exec(r||"");return l?(0,s.jsx)("code",{className:r,...n,children:a}):(0,s.jsx)(ea,{language:i&&i[1]||"",value:String(a).replace(/\n$/,""),...n},Math.random())},table(e){let{children:t}=e;return(0,s.jsx)("table",{className:"border-collapse border border-black px-3 py-1 dark:border-white",children:t})},th(e){let{children:t}=e;return(0,s.jsx)("th",{className:"break-words border border-black bg-gray-500 px-3 py-1 text-white dark:border-white",children:t})},td(e){let{children:t}=e;return(0,s.jsx)("td",{className:"break-words border border-black px-3 py-1 dark:border-white",children:t})}},children:"".concat(l.content).concat(p&&a==(null!==(t=null==u?void 0:u.messages.length)&&void 0!==t?t:0)-1?"`▍`":"")}),(0,s.jsxs)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:[(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:o,children:(0,s.jsx)(q.Z,{size:20})}),C?(0,s.jsx)(W.Z,{size:20,className:"text-green-500 dark:text-green-400"}):(0,s.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:O,children:(0,s.jsx)(X.Z,{size:20})})]})]})})]})})});eu.displayName="ChatMessage";let em=(0,n.memo)(eu,(e,t)=>e.message.content===t.message.content);var ex=l(83454);let ep=async(e,t,l,r,a,s,n)=>{let i;i=t?[{role:"system",content:t},...s]:s;let o=await fetch("".concat(r,"/v1/chat/completions"),{headers:{accept:"*/*","Content-Type":"application/json",Authorization:"Bearer ".concat(a||ex.env.NEXT_PUBLIC_OPENAI_API_KEY)},method:"POST",body:JSON.stringify({model:e.id,messages:i,stream:!0}),signal:n?n.signal:null});return o.body},eh=async(e,t,l,r,a,s)=>{let n=await fetch("".concat(r,"/v1/chat/completions"),{headers:{accept:"*/*","Content-Type":"application/json",Authorization:"Bearer ".concat(a||ex.env.NEXT_PUBLIC_OPENAI_API_KEY)},method:"POST",body:JSON.stringify({model:e.id,messages:[{role:"system",content:t},...s],stream:!1})});return await n.json()},eg=(0,n.memo)(e=>{var t,l;let r,a;let o,{stopConversationRef:d}=e,{t:c}=(0,i.$G)("chat"),{state:{selectedConversation:u,conversations:m,models:x,isStream:p,lightMode:h,api:v,apiKey:f,pluginKeys:j,modelError:k,loading:N,prompts:C,controller:S},handleUpdateConversation:E,dispatch:P}=(0,n.useContext)(L),[A,T]=(0,n.useState)(),[z,O]=(0,n.useState)(0),[Z,R]=(0,n.useState)(!0),[M,U]=(0,n.useState)(!1),[B,$]=(0,n.useState)(!1),Y=(0,n.useRef)(null),q=(0,n.useRef)(null),W=(0,n.useRef)(null),X=(0,n.useRef)([]),V="",Q=!0,ee=(0,n.useRef)(!1),et=!0;async function el(){if(et&&u&&X.current.length>0){et=!1;for(let e=0;e<X.current.length;e++)if(V+=X.current.shift(),V=V.replace(/<\|.*?\|>/g,""),Q){Q=!1,P({field:"loading",value:!1});let e=[...o.messages,{role:"assistant",content:V||""}];P({field:"selectedConversation",value:o={...o,messages:e}})}else{let e=o.messages.map((e,t)=>t===o.messages.length-1?{...e,content:V}:e);y(o={...o,messages:e}),P({field:"selectedConversation",value:o});let t=m.map(e=>e.id===u.id?o:e);0===t.length&&t.push(o),P({field:"conversations",value:t}),w(t),ee.current}et=!0}}let er=async()=>{for(;0!==X.current.length;)await el()},ea=(0,n.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2],u){let r;if(t){let l=[...u.messages];for(let e=0;e<t;e++)l.pop();o={...u,messages:[...l,e]}}else if(o={...u,messages:[...u.messages,e]},0===u.messages.length){var l;o={...o,name:"string"==typeof e.content?e.content:(null===(l=e.content.find(e=>"text"===e.type))||void 0===l?void 0:l.text)||""}}r=o.messages.map(e=>"string"!=typeof e.content?{...e,content:e.content.map(e=>"image_url"===e.type&&e.image_url&&e.image_url.url.startsWith("data:image/")?{...e,image_url:{url:e.image_url.url.split(",")[1]}}:e)}:e),P({field:"selectedConversation",value:o}),P({field:"loading",value:!0}),P({field:"messageIsStreaming",value:!0});let a={model:o.model,messages:r,key:f,prompt:o.prompt,temperature:o.temperature},s=new AbortController;try{let{model:e,messages:t,key:l,prompt:r,temperature:n}=a,i=n;null==i&&(i=g);let d=[];for(let e=t.length-1;e>=0;e--){let l=t[e];d=[l,...d]}if(p){ee.current=!1,new Date().getTime();let t=new AbortController;P({field:"controller",value:t});let a=await ep(e,r,i,v,l,d,t);if(a){let e="",t=new TextDecoder,l=a.getReader();for(;!ee.current;){let{value:r,done:a}=await l.read();a&&(ee.current=!0);let s=t.decode(r);if(s){let t=s.split("\n\n");new Date().getTime(),t.length,t.forEach(t=>{let l=!1;if((t=t.trim()).startsWith("data: ")&&(t=t.substring(6).trim()),"[DONE]"===t?ee.current=!0:t.startsWith("{")?t.endsWith("}")||(e=t,l=!0):e?(t=e+t,e=""):l=!0,!l&&!ee.current)try{if(t){let e=JSON.parse(t);e&&e.choices&&e.choices.forEach(e=>{e&&e.delta&&e.delta.content&&X.current.push(e.delta.content)})}}catch(e){console.log("error JSON",t)}})}et&&er()}P({field:"messageIsStreaming",value:!1}),s.abort()}else P({field:"loading",value:!1}),P({field:"messageIsStreaming",value:!1})}else{let t=await eh(e,r,i,v,l,d);if(t){let e=t.choices[0].message,l=[...o.messages,{role:"assistant",content:e.content}];o={...o,messages:l},P({field:"selectedConversation",value:b}),y(o);let r=m.map(e=>e.id===u.id?o:e);0===r.length&&r.push(o),P({field:"conversations",value:r}),w(r),P({field:"loading",value:!1}),P({field:"messageIsStreaming",value:!1}),P({field:"selectedConversation",value:o})}}}catch(e){console.error(e)}}},[v,f,m,j,p,u,d]);(0,n.useCallback)(()=>{if(Z){var e,t;null===(e=Y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),null===(t=W.current)||void 0===t||t.focus()}},[Z]);let es=()=>{if(q.current){let{scrollTop:e,scrollHeight:t,clientHeight:l}=q.current;e+l<t-30?(R(!1),$(!0)):(R(!0),$(!1))}},en=()=>{var e;null===(e=q.current)||void 0===e||e.scrollTo({top:q.current.scrollHeight,behavior:"smooth"})},ei=()=>{U(!M)},eo=()=>{confirm(c("Are you sure you want to clear all messages?"))&&u&&E(u,{key:"messages",value:[]})},ed=()=>{if(Z){var e;null===(e=Y.current)||void 0===e||e.scrollIntoView(!0)}},ec=function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];a?(clearTimeout(r),r=setTimeout(()=>{Date.now()-a>=250&&(ed(...t),a=Date.now())},250-(Date.now()-a))):(ed(...t),a=Date.now())};return(0,n.useEffect)(()=>{ec(),u&&(O(null==u?void 0:u.messages.reduce((e,t)=>(Array.isArray(t.content)&&(e+=t.content.reduce((e,t)=>("image_url"===t.type&&t.image_url&&e++,e),0)),e),0)),T(u.messages[u.messages.length-2]))},[u,ec]),(0,n.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;if(R(t.isIntersecting),t.isIntersecting){var l;null===(l=W.current)||void 0===l||l.focus()}},{root:null,threshold:.5}),t=Y.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[Y]),(0,s.jsx)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541]",children:k?(0,s.jsx)(J,{error:k}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"max-h-full overflow-x-hidden",ref:q,onScroll:es,children:(null==u?void 0:null===(t=u.messages)||void 0===t?void 0:t.length)===0?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"mx-auto flex flex-col space-y-5 md:space-y-10 px-3 pt-5 md:pt-12 sm:max-w-[600px]",children:[(0,s.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:(null==x?void 0:x.length)===0?(0,s.jsx)("div",{children:(0,s.jsx)(G,{size:"16px",className:"mx-auto"})}):(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,s.jsx)("img",{style:{height:"4rem"},src:"llamaedge.svg"}),"LlamaEdge Chat"]})}),(null==x?void 0:x.length)>0&&(0,s.jsxs)("div",{className:"flex h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600",children:[(0,s.jsx)(H,{}),(null==u?void 0:u.promptState)!==2&&(0,s.jsx)(F,{conversation:u,prompts:C,onChangePrompt:e=>E(u,{key:"prompt",value:e})})]})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"sticky top-0 z-10 flex justify-center border border-b-neutral-300 bg-neutral-100 py-2 text-sm text-neutral-500 dark:border-none dark:bg-[#444654] dark:text-neutral-200",children:[c("Model"),": ",null==u?void 0:null===(l=u.model)||void 0===l?void 0:l.id," | ",c("Temp"),": ",null==u?void 0:u.temperature," |",(0,s.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:ei,children:(0,s.jsx)(I.Z,{size:18})}),(0,s.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:eo,children:(0,s.jsx)(_.Z,{size:18})})]}),M&&(0,s.jsx)("div",{className:"flex flex-col space-y-10 md:mx-auto md:max-w-xl md:gap-6 md:py-3 md:pt-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:(0,s.jsx)("div",{className:"flex h-full flex-col space-y-4 border-b border-neutral-200 p-4 dark:border-neutral-600 md:rounded-lg md:border",children:(0,s.jsx)(H,{})})}),(null==u?void 0:u.messages)&&u.messages.map((e,t)=>(0,s.jsx)(em,{message:e,messageIndex:t,maxImg:1-z,onRegenerate:()=>{A&&ea(A,u.messages.length-t+1,null)},onEdit:e=>{T(e),ea(e,(null==u?void 0:u.messages.length)-t)}},t)),N&&(0,s.jsx)(K,{}),(0,s.jsx)("div",{className:"h-[162px] bg-white dark:bg-[#343541]",ref:Y})]})}),((null==u?void 0:u.promptState)!==1||(null==u?void 0:u.prompt)!=="")&&(0,s.jsx)(D,{maxImg:1-z,stopConversationRef:d,textareaRef:W,onSend:(e,t)=>{T(e),ea(e,0,t)},onScrollDownClick:en,onRegenerate:()=>{A&&ea(A,2,null)},showScrollDownButton:B})]})})});eg.displayName="Chat";let ev=()=>{let e=localStorage.getItem("conversationHistory"),t=localStorage.getItem("folders"),l=localStorage.getItem("prompts");e&&(e=JSON.parse(e)),t&&(t=JSON.parse(t)),l&&(l=JSON.parse(l));let r={version:4,history:e||[],folders:t||[],prompts:l||[]},a=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.download="chatbot_ui_history_".concat(function(){let e=new Date,t=e.getMonth()+1,l=e.getDate();return"".concat(t,"-").concat(l)}(),".json"),n.href=s,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},ef=e=>{let{history:t,folders:l,prompts:r}=function(e){if(Array.isArray(e))return{version:4,history:f(e),folders:[],prompts:[]};if(!("version"in e)&&"folders"in e&&"history"in e)return{version:4,history:f(e.history||[]),folders:(e.folders||[]).map(e=>({id:e.id.toString(),name:e.name,type:"chat"})),prompts:[]};if(3===e.version)return{...e,version:4,prompts:[]};if(4===e.version)return e;throw Error("Unsupported data format")}(e),a=localStorage.getItem("conversationHistory"),s=a?JSON.parse(a):[],n=[...s,...t].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));localStorage.setItem("conversationHistory",JSON.stringify(n)),n.length>0?localStorage.setItem("selectedConversation",JSON.stringify(n[n.length-1])):localStorage.removeItem("selectedConversation");let i=localStorage.getItem("folders"),o=i?JSON.parse(i):[],d=[...o,...l].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));localStorage.setItem("folders",JSON.stringify(d));let c=localStorage.getItem("prompts"),u=c?JSON.parse(c):[],m=[...u,...r].filter((e,t,l)=>t===l.findIndex(t=>t.id===e.id));return localStorage.setItem("prompts",JSON.stringify(m)),{version:4,history:n,folders:d,prompts:m}};var eb=l(87664),ey=l(62577),ew=l(97283),ej=l(30471);let ek=e=>{let{handleClick:t,children:l}=e;return(0,s.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:t,children:l})},eN=e=>{let{currentFolder:t,searchTerm:l,handleDrop:r,folderComponent:a}=e,{handleDeleteFolder:i,handleUpdateFolder:o}=(0,n.useContext)(L),[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),[h,g]=(0,n.useState)(!1),v=e=>{"Enter"===e.key&&(e.preventDefault(),f())},f=()=>{o(t.id,x),p(""),m(!1)},b=e=>{e.dataTransfer&&(g(!0),r(e,t),e.target.style.background="none")},y=e=>{e.preventDefault()},w=e=>{e.target.style.background="#343541"},j=e=>{e.target.style.background="none"};return(0,n.useEffect)(()=>{u?c(!1):d&&m(!1)},[u,d]),(0,n.useEffect)(()=>{l?g(!0):g(!1)},[l]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative flex items-center",children:[u?(0,s.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3",children:[h?(0,s.jsx)(eb.Z,{size:18}):(0,s.jsx)(ey.Z,{size:18}),(0,s.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:x,onChange:e=>p(e.target.value),onKeyDown:v,autoFocus:!0})]}):(0,s.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>g(!h),onDrop:e=>b(e),onDragOver:y,onDragEnter:w,onDragLeave:j,children:[h?(0,s.jsx)(eb.Z,{size:18}):(0,s.jsx)(ey.Z,{size:18}),(0,s.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:t.name})]}),(d||u)&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ek,{handleClick:e=>{e.stopPropagation(),d?i(t.id):u&&f(),c(!1),m(!1)},children:(0,s.jsx)(W.Z,{size:18})}),(0,s.jsx)(ek,{handleClick:e=>{e.stopPropagation(),c(!1),m(!1)},children:(0,s.jsx)(ew.Z,{size:18})})]}),!d&&!u&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ek,{handleClick:e=>{e.stopPropagation(),m(!0),p(t.name)},children:(0,s.jsx)(ej.Z,{size:18})}),(0,s.jsx)(ek,{handleClick:e=>{e.stopPropagation(),c(!0)},children:(0,s.jsx)(Y.Z,{size:18})})]})]}),h?a:null]})};var eC=l(47447);let eS=(0,n.createContext)(void 0),eI=e=>{let{conversation:t}=e,{state:{selectedConversation:l,messageIsStreaming:r},handleSelectConversation:a,handleUpdateConversation:i}=(0,n.useContext)(L),{handleDeleteConversation:o}=(0,n.useContext)(eS),[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),h=e=>{"Enter"===e.key&&(e.preventDefault(),l&&v(l))},g=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("conversation",JSON.stringify(t))},v=e=>{x.trim().length>0&&(i(e,{key:"name",value:x}),p(""),m(!1))},f=e=>{e.stopPropagation(),d?o(t):u&&v(t),c(!1),m(!1)},b=e=>{e.stopPropagation(),c(!1),m(!1)},y=e=>{e.stopPropagation(),m(!0),l&&p(l.name)},w=e=>{e.stopPropagation(),c(!0)};return(0,n.useEffect)(()=>{u?c(!1):d&&m(!1)},[u,d]),(0,s.jsxs)("div",{className:"relative flex items-center",children:[u&&(null==l?void 0:l.id)===t.id?(0,s.jsxs)("div",{className:"flex w-full items-center gap-3 rounded-lg bg-[#343541]/90 p-3",children:[(0,s.jsx)(eC.Z,{size:18}),(0,s.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:x,onChange:e=>p(e.target.value),onKeyDown:h,autoFocus:!0})]}):(0,s.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90 ".concat(r?"disabled:cursor-not-allowed":""," ").concat((null==l?void 0:l.id)===t.id?"bg-[#343541]/90":""),onClick:()=>a(t),disabled:r,draggable:"true",onDragStart:e=>g(e,t),children:[(0,s.jsx)(eC.Z,{size:18}),(0,s.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3 ".concat((null==l?void 0:l.id)===t.id?"pr-12":"pr-1"),children:t.name})]}),(d||u)&&(null==l?void 0:l.id)===t.id&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ek,{handleClick:f,children:(0,s.jsx)(W.Z,{size:18})}),(0,s.jsx)(ek,{handleClick:b,children:(0,s.jsx)(ew.Z,{size:18})})]}),(null==l?void 0:l.id)===t.id&&!d&&!u&&(0,s.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,s.jsx)(ek,{handleClick:y,children:(0,s.jsx)(ej.Z,{size:18})}),(0,s.jsx)(ek,{handleClick:w,children:(0,s.jsx)(Y.Z,{size:18})})]})]})},e_=e=>{let{searchTerm:t}=e,{state:{folders:l,conversations:r},handleUpdateConversation:a}=(0,n.useContext)(L),i=(e,t)=>{if(e.dataTransfer){let l=JSON.parse(e.dataTransfer.getData("conversation"));a(l,{key:"folderId",value:t.id})}},o=e=>r&&r.filter(e=>e.folderId).map((t,l)=>{if(t.folderId===e.id)return(0,s.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,s.jsx)(eI,{conversation:t})},l)});return(0,s.jsx)("div",{className:"flex w-full flex-col pt-2",children:l.filter(e=>"chat"===e.type).sort((e,t)=>e.name.localeCompare(t.name)).map((e,l)=>(0,s.jsx)(eN,{searchTerm:t,currentFolder:e,handleDrop:i,folderComponent:o(e)},l))})};var eL=l(75846);let eE=e=>{let{open:t,onClose:l}=e,{t:r}=(0,i.$G)("settings"),a=C(),{state:o,dispatch:d}=c({initialState:a}),{dispatch:u}=(0,n.useContext)(L),m=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&window.addEventListener("mouseup",t)},t=e=>{window.removeEventListener("mouseup",t),l()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[l]);let x=()=>{u({field:"lightMode",value:o.theme}),u({field:"isStream",value:o.isStream}),console.log(o.isStream),S(o)};return t?(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:(0,s.jsx)("div",{className:"fixed inset-0 z-10 overflow-hidden",children:(0,s.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,s.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,s.jsxs)("div",{ref:m,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,s.jsx)("div",{className:"text-lg pb-4 font-bold text-black dark:text-neutral-200",children:r("Settings")}),(0,s.jsx)("div",{className:"text-sm font-bold mb-2 text-black dark:text-neutral-200",children:r("Theme")}),(0,s.jsxs)("select",{className:"w-full cursor-pointer bg-transparent p-2 text-neutral-700 dark:text-neutral-200",value:o.theme,onChange:e=>d({field:"theme",value:e.target.value}),children:[(0,s.jsx)("option",{value:"dark",children:r("Dark mode")}),(0,s.jsx)("option",{value:"light",children:r("Light mode")})]}),(0,s.jsx)("div",{className:"text-sm font-bold mb-2 text-black dark:text-neutral-200",children:r("Output type")}),(0,s.jsxs)("select",{className:"w-full cursor-pointer bg-transparent p-2 text-neutral-700 dark:text-neutral-200",value:o.isStream.toString(),onChange:e=>{console.log(e.target.value),d({field:"isStream",value:"true"===e.target.value})},children:[(0,s.jsx)("option",{value:"false",children:r("Completed output")}),(0,s.jsx)("option",{value:"true",children:r("Streaming output")})]}),(0,s.jsx)("button",{type:"button",className:"w-full px-4 py-2 mt-6 border rounded-lg shadow border-neutral-500 text-neutral-900 hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:()=>{x(),l()},children:r("Save")})]})]})})}):(0,s.jsx)(s.Fragment,{})};var eP=l(52216);let eA=e=>{let{text:t,icon:l,onClick:r}=e;return(0,s.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:r,children:[(0,s.jsx)("div",{children:l}),(0,s.jsx)("span",{children:t})]})},eT=e=>{let{onImport:t}=e,{t:l}=(0,i.$G)("sidebar");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{id:"import-file",className:"sr-only",tabIndex:-1,type:"file",accept:".json",onChange:e=>{var l;if(!(null===(l=e.target.files)||void 0===l?void 0:l.length))return;let r=e.target.files[0],a=new FileReader;a.onload=e=>{var l;t(JSON.parse(null===(l=e.target)||void 0===l?void 0:l.result))},a.readAsText(r)}}),(0,s.jsx)(eA,{text:l("Import data"),icon:(0,s.jsx)(eP.Z,{size:18}),onClick:()=>{let e=document.querySelector("#import-file");e&&e.click()}})]})};var ez=l(35336);let eO=e=>{let{apiKey:t,onApiKeyChange:l}=e,{t:r}=(0,i.$G)("sidebar"),[a,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(t),u=(0,n.useRef)(null);(0,n.useEffect)(()=>{c(t)},[t]);let m=e=>{"Enter"===e.key&&(e.preventDefault(),x(d))},x=e=>{l(e.trim()),o(!1)};return(0,n.useEffect)(()=>{if(a){var e;null===(e=u.current)||void 0===e||e.focus()}},[a]),a?(0,s.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-3 px-3 transition-colors hover:bg-gray-500/10",children:[(0,s.jsx)(ez.Z,{size:18}),(0,s.jsx)("input",{ref:u,className:"ml-2 h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-white outline-none focus:border-neutral-100",type:"password",value:d,onChange:e=>c(e.target.value),onKeyDown:m,placeholder:r("API Key")||"API Key"}),(0,s.jsxs)("div",{className:"flex w-[40px]",children:[(0,s.jsx)(W.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),x(d)}}),(0,s.jsx)(ew.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),o(!1),c(t)}})]})]}):(0,s.jsx)(eA,{text:r("API Key"),icon:(0,s.jsx)(ez.Z,{size:18}),onClick:()=>o(!0)})};var eZ=l(47083);let eD=e=>{let{api:t,onApiChange:l}=e,{t:r}=(0,i.$G)("sidebar"),[a,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(t),u=(0,n.useRef)(null);(0,n.useEffect)(()=>{c(t)},[t]);let m=e=>{"Enter"===e.key&&(e.preventDefault(),x(d))},x=e=>{l(e.trim()),o(!1)};return(0,n.useEffect)(()=>{if(a){var e;null===(e=u.current)||void 0===e||e.focus()}},[a]),a?(0,s.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-3 px-3 transition-colors hover:bg-gray-500/10",children:[(0,s.jsx)(eZ.Z,{size:18}),(0,s.jsx)("input",{ref:u,className:"ml-2 h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-white outline-none focus:border-neutral-100",value:d,onChange:e=>c(e.target.value),onKeyDown:m,placeholder:r("API Url")||"API Url"}),(0,s.jsxs)("div",{className:"flex w-[40px]",children:[(0,s.jsx)(W.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),x(d)}}),(0,s.jsx)(ew.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),o(!1),c(t)}})]})]}):(0,s.jsx)(eA,{text:r("Chat API Url"),icon:(0,s.jsx)(eZ.Z,{size:18}),onClick:()=>o(!0)})},eR=e=>{let{onClearConversations:t}=e,[l,r]=(0,n.useState)(!1),{t:a}=(0,i.$G)("sidebar"),o=()=>{t(),r(!1)};return l?(0,s.jsxs)("div",{className:"flex w-full cursor-pointer items-center rounded-lg py-3 px-3 hover:bg-gray-500/10",children:[(0,s.jsx)(Y.Z,{size:18}),(0,s.jsx)("div",{className:"ml-3 flex-1 text-left text-[12.5px] leading-3 text-white",children:a("Are you sure?")}),(0,s.jsxs)("div",{className:"flex w-[40px]",children:[(0,s.jsx)(W.Z,{className:"ml-auto mr-1 min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),o()}}),(0,s.jsx)(ew.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),r(!1)}})]})]}):(0,s.jsx)(eA,{text:a("Clear conversations"),icon:(0,s.jsx)(Y.Z,{size:18}),onClick:()=>r(!0)})},eK=()=>{let{t:e}=(0,i.$G)("sidebar"),[t,l]=(0,n.useState)(!1),{state:{api:r,apiKey:a,lightMode:o,serverSideApiKeyIsSet:d,serverSidePluginKeysSet:c,conversations:u},dispatch:m}=(0,n.useContext)(L),{handleClearConversations:x,handleImportConversations:p,handleExportData:h,handleApiChange:g,handleApiKeyChange:v}=(0,n.useContext)(eS);return(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-1 border-t border-white/20 pt-1 text-sm",children:[u.length>0?(0,s.jsx)(eR,{onClearConversations:x}):null,(0,s.jsx)(eT,{onImport:p}),(0,s.jsx)(eA,{text:e("Export data"),icon:(0,s.jsx)(eL.Z,{size:18}),onClick:()=>h()}),(0,s.jsx)(eA,{text:e("Settings"),icon:(0,s.jsx)(I.Z,{size:18}),onClick:()=>l(!0)}),(0,s.jsx)(eD,{api:r,onApiChange:g}),(0,s.jsx)(eO,{apiKey:a,onApiKeyChange:v}),(0,s.jsx)(eE,{open:t,onClose:()=>{l(!1)}})]})},eG=e=>{let{conversations:t}=e;return(0,s.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.filter(e=>!e.folderId).slice().reverse().map((e,t)=>(0,s.jsx)(eI,{conversation:e},t))})};var eM=l(1177),eJ=l(16745),eU=l(92005),eH=l(67421),eF=l(98963),eB=l(89014);let e$=e=>{let{onClick:t,side:l}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"fixed top-5 ".concat("right"===l?"right-[270px]":"left-[270px]"," z-50 h-7 w-7 hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===l?"right-[270px]":"left-[270px]"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===l?(0,s.jsx)(eF.Z,{}):(0,s.jsx)(eB.Z,{})}),(0,s.jsx)("div",{onClick:t,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]})},eY=e=>{let{onClick:t,side:l}=e;return(0,s.jsx)("button",{className:"fixed top-2.5 ".concat("right"===l?"right-2":"left-2"," z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===l?"right-2":"left-2"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===l?(0,s.jsx)(eB.Z,{}):(0,s.jsx)(eF.Z,{})})},eq=e=>{let{placeholder:t,searchTerm:l,onSearch:r}=e,{t:a}=(0,i.$G)("sidebar"),n=e=>{r(e.target.value)},o=()=>{r("")};return(0,s.jsxs)("div",{className:"relative flex items-center",children:[(0,s.jsx)("input",{className:"w-full flex-1 rounded-md border border-neutral-600 bg-[#202123] px-4 py-3 pr-10 text-[14px] leading-3 text-white",type:"text",placeholder:a(t)||"",value:l,onChange:n}),l&&(0,s.jsx)(ew.Z,{className:"absolute right-4 cursor-pointer text-neutral-300 hover:text-neutral-400",size:18,onClick:o})]})},eW=e=>{let{isOpen:t,addItemButtonTitle:l,canCreateChat:r,side:a,items:n,itemComponent:i,folderComponent:o,footerComponent:d,searchTerm:c,handleSearchTerm:u,toggleOpen:m,handleCreateItem:x,handleCreateFolder:p,handleDrop:h}=e,{t:g}=(0,eH.$G)("promptbar"),v=e=>{e.preventDefault()},f=e=>{e.target.style.background="#343541"},b=e=>{e.target.style.background="none"};return t?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"fixed top-0 ".concat(a,"-0 z-40 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 text-[14px] transition-all sm:relative sm:top-0"),children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("button",{disabled:!r,className:"text-sidebar flex w-[190px] flex-shrink-0 select-none items-center gap-3 rounded-md border border-white/20 p-3 text-white transition-colors duration-200 hover:bg-gray-500/10 "+(r?"cursor-pointer":"cursor-not-allowed"),onClick:()=>{x(),u("")},children:[(0,s.jsx)(eM.Z,{size:16}),l]}),(0,s.jsx)("button",{disabled:!r,className:"ml-2 flex flex-shrink-0 items-center gap-3 rounded-md border border-white/20 p-3 text-sm text-white transition-colors duration-200 hover:bg-gray-500/10 "+(r?"cursor-pointer":"cursor-not-allowed"),onClick:p,children:(0,s.jsx)(eJ.Z,{size:16})})]}),(0,s.jsx)(eq,{placeholder:g("Search...")||"",searchTerm:c,onSearch:u}),(0,s.jsxs)("div",{className:"flex-grow overflow-auto",children:[(null==n?void 0:n.length)>0&&(0,s.jsx)("div",{className:"flex border-b border-white/20 pb-2",children:o}),(null==n?void 0:n.length)>0?(0,s.jsx)("div",{className:"pt-2",onDrop:h,onDragOver:v,onDragEnter:f,onDragLeave:b,children:i}):(0,s.jsxs)("div",{className:"mt-8 select-none text-center text-white opacity-50",children:[(0,s.jsx)(eU.Z,{className:"mx-auto mb-3"}),(0,s.jsx)("span",{className:"text-[14px] leading-normal",children:g("No data.")})]})]}),d]}),(0,s.jsx)(e$,{onClick:m,side:a})]}):(0,s.jsx)(eY,{onClick:m,side:a})},eX={searchTerm:"",filteredConversations:[]};var eV=l(57632);let eQ=()=>{let{t:e}=(0,i.$G)("sidebar"),t=c({initialState:eX}),{state:{conversations:l,showChatbar:r,models:a,folders:o,pluginKeys:d},dispatch:u,handleCreateFolder:m,handleNewConversation:x,handleUpdateConversation:p}=(0,n.useContext)(L),{state:{searchTerm:h,filteredConversations:v},dispatch:f}=t,b=(0,n.useCallback)(e=>{u({field:"api",value:e}),localStorage.setItem("api",e)},[u]),k=(0,n.useCallback)(e=>{u({field:"apiKey",value:e}),localStorage.setItem("apiKey",e)},[u]),N=e=>{if(d.some(t=>t.pluginId===e.pluginId)){let t=d.map(t=>t.pluginId===e.pluginId?e:t);u({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))}else u({field:"pluginKeys",value:[...d,e]}),localStorage.setItem("pluginKeys",JSON.stringify([...d,e]))},C=e=>{let t=d.filter(t=>t.pluginId!==e.pluginId);if(0===t.length){u({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys");return}u({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))},S=()=>{ev()},I=e=>{let{history:t,folders:l,prompts:r}=ef(e);u({field:"conversations",value:t}),u({field:"selectedConversation",value:t[t.length-1]}),u({field:"folders",value:l}),u({field:"prompts",value:r}),window.location.reload()},_=()=>{if(a&&a.length>0){var t,l;u({field:"selectedConversation",value:{id:(0,eV.Z)(),name:e("New Conversation"),messages:[],model:a[0],prompt:(null===(t=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===t?void 0:t.content)||"",promptState:(null===(l=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===l?void 0:l.controlState)||0,temperature:g,folderId:null}})}u({field:"conversations",value:[]}),localStorage.removeItem("conversationHistory"),localStorage.removeItem("selectedConversation");let r=o.filter(e=>"chat"!==e.type);u({field:"folders",value:r}),j(r)},E=t=>{let r=l.filter(e=>e.id!==t.id);if(u({field:"conversations",value:r}),f({field:"searchTerm",value:""}),w(r),r.length>0)u({field:"selectedConversation",value:r[r.length-1]}),y(r[r.length-1]);else{if(a&&a.length>0){var s,n;u({field:"selectedConversation",value:{id:(0,eV.Z)(),name:e("New Conversation"),messages:[],model:a[0],prompt:(null===(s=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===s?void 0:s.content)||"",promptState:(null===(n=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=a[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===n?void 0:n.controlState)||0,temperature:g,folderId:null}})}localStorage.removeItem("selectedConversation")}},P=()=>{u({field:"showChatbar",value:!r}),localStorage.setItem("showChatbar",JSON.stringify(!r))},A=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("conversation"));p(t,{key:"folderId",value:0}),f({field:"searchTerm",value:""}),e.target.style.background="none"}};return(0,n.useEffect)(()=>{h?f({field:"filteredConversations",value:l.filter(e=>{let t=e.name.toLocaleLowerCase()+" "+e.messages.map(e=>e.content).join(" ");return t.toLowerCase().includes(h.toLowerCase())})}):f({field:"filteredConversations",value:l})},[h,l]),(0,s.jsx)(eS.Provider,{value:{...t,handleDeleteConversation:E,handleClearConversations:_,handleImportConversations:I,handleExportData:S,handlePluginKeyChange:N,handleClearPluginKey:C,handleApiChange:b,handleApiKeyChange:k},children:(0,s.jsx)(eW,{side:"left",isOpen:r,canCreateChat:a&&a.length>0,addItemButtonTitle:e("New chat"),itemComponent:(0,s.jsx)(eG,{conversations:v}),folderComponent:(0,s.jsx)(e_,{searchTerm:h}),items:v,searchTerm:h,handleSearchTerm:e=>f({field:"searchTerm",value:e}),toggleOpen:P,handleCreateItem:x,handleCreateFolder:()=>m(e("New folder"),"chat"),handleDrop:A,footerComponent:(0,s.jsx)(eK,{})})})},e0=e=>{let{selectedConversation:t,onNewConversation:l}=e;return(0,s.jsxs)("nav",{className:"flex w-full justify-between bg-[#202123] py-3 px-4",children:[(0,s.jsx)("div",{className:"mr-4"}),(0,s.jsx)("div",{className:"max-w-[240px] overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),(0,s.jsx)(eM.Z,{className:"cursor-pointer hover:text-neutral-400 mr-8",onClick:l})]})},e1={api:"",apiKey:"",loading:!1,pluginKeys:[],lightMode:"dark",isStream:!0,messageIsStreaming:!1,modelError:null,models:[],folders:[],conversations:[],selectedConversation:void 0,currentMessage:void 0,prompts:[],temperature:1,showPromptbar:!0,showChatbar:!0,currentFolder:void 0,messageError:!1,searchTerm:"",defaultModelId:void 0,serverSideApiKeyIsSet:!1,serverSidePluginKeysSet:!1,controller:null},e2=e=>{let t,{serverSideApiKeyIsSet:l,serverSidePluginKeysSet:r,defaultModelId:a}=e,{t:o}=(0,i.$G)("chat"),{getModels:m}=x(),p=(0,u.useRouter)(),h=c({initialState:e1}),{state:{api:N,apiKey:S,lightMode:I,folders:_,conversations:E,selectedConversation:P,prompts:A,models:T},dispatch:z}=h,O=(0,n.useRef)(!1),Z=async()=>{t=await m({url:N,key:S}),z&&t&&(Array.isArray(t)?t.length>0:Object.keys(t).length>0)&&z({field:"models",value:t})};(0,n.useEffect)(()=>{T&&(!E||E&&0===E.length)&&M&&M()},[T]),(0,n.useEffect)(()=>{p.query.api_url&&(localStorage.setItem("api",p.query.api_url),z({field:"api",value:p.query.api_url}))},[p.query.api_url]),(0,n.useEffect)(()=>{p.query.api_key&&(localStorage.setItem("apiKey",p.query.api_key),z({field:"apiKey",value:p.query.api_key}))},[p.query.api_key]),(0,n.useEffect)(()=>{Z()},[N,S]);let D=e=>{z({field:"selectedConversation",value:e}),y(e)},R=(e,t)=>{let l={id:(0,eV.Z)(),name:e,type:t},r=[..._,l];z({field:"folders",value:r}),j(r)},K=e=>{let t=_.filter(t=>t.id!==e);z({field:"folders",value:t}),j(t);let l=E.map(t=>t.folderId===e?{...t,folderId:null}:t);z({field:"conversations",value:l}),w(l);let r=A.map(t=>t.folderId===e?{...t,folderId:null}:t);z({field:"prompts",value:r}),k(r)},G=(e,t)=>{let l=_.map(l=>l.id===e?{...l,name:t}:l);z({field:"folders",value:l}),j(l)},M=async()=>{await Z();let e=E[E.length-1];if(T&&T.length>0){var t,l,r;let a={id:(0,eV.Z)(),name:o("New Conversation"),messages:[],model:(null==e?void 0:e.model)&&function(e,t){for(let l of e)if(l.id===t.id)return!0;return!1}(T,null==e?void 0:e.model)&&(null==e?void 0:e.model)||T[0],prompt:(null===(t=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=T[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===t?void 0:t.content)||"",promptState:(null===(l=U.find(e=>{var t,l;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=T[0].name)||void 0===l?void 0:l.toLowerCase())}))||void 0===l?void 0:l.controlState)||0,temperature:null!==(r=null==e?void 0:e.temperature)&&void 0!==r?r:g,folderId:null},s=[...E,a];z({field:"selectedConversation",value:a}),z({field:"conversations",value:s}),y(a),w(s),z({field:"loading",value:!1})}},J=(e,t)=>{let l={...e,[t.key]:t.value},{single:r,all:a}=b(l,E);z({field:"selectedConversation",value:r}),z({field:"conversations",value:a})},H=(e,t)=>{let l=Object.assign(e);t.forEach(e=>{l[e.key]=e.value});let{single:r,all:a}=b(l,E);z({field:"selectedConversation",value:r}),z({field:"conversations",value:a})};return(0,n.useEffect)(()=>{window.innerWidth<640&&z({field:"showChatbar",value:!1})},[P]),(0,n.useEffect)(()=>{l&&z({field:"serverSideApiKeyIsSet",value:l}),r&&z({field:"serverSidePluginKeysSet",value:r})},[l,r]),(0,n.useEffect)(()=>{var e,t,a,s,n;let i=C();i.theme&&z({field:"lightMode",value:i.theme}),i.isStream&&z({field:"isStream",value:i.isStream});let d=localStorage.getItem("api"),c=localStorage.getItem("apiKey");l?(z({field:"apiKey",value:""}),localStorage.removeItem("apiKey")):c&&z({field:"apiKey",value:c}),d&&z({field:"api",value:d});let u=localStorage.getItem("pluginKeys");r?(z({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys")):u&&z({field:"pluginKeys",value:u}),window.innerWidth<640&&z({field:"showChatbar",value:!1});let m=localStorage.getItem("showChatbar");m&&z({field:"showChatbar",value:"true"===m});let x=localStorage.getItem("folders");x&&z({field:"folders",value:JSON.parse(x)});let p=localStorage.getItem("prompts");p&&z({field:"prompts",value:JSON.parse(p)});let h=localStorage.getItem("conversationHistory");if(h){let e=JSON.parse(h),t=f(e);z({field:"conversations",value:t})}let b=localStorage.getItem("selectedConversation");if(b){let l=JSON.parse(b),r=v(l);if(r.model&&T&&T.length>0){let l=T.filter(e=>e.id===r.model.id);l&&0!==l.length||(r.model=T[0],r.prompt=(null===(e=U.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=T[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===e?void 0:e.content)||"",r.promptState=(null===(t=U.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=T[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===t?void 0:t.controlState)||0)}z({field:"selectedConversation",value:r})}else{let e=E[E.length-1],t={id:(0,eV.Z)(),name:o("New Conversation"),messages:[],temperature:null!==(a=null==e?void 0:e.temperature)&&void 0!==a?a:g,folderId:null};T&&T.length>0&&(t.model=T[0],t.prompt=(null===(s=U.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=T[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===s?void 0:s.content)||"",t.promptState=(null===(n=U.find(e=>{var t,l,r;return(null===(t=e.id)||void 0===t?void 0:t.toLowerCase())===(null===(l=T[0])||void 0===l?void 0:null===(r=l.name)||void 0===r?void 0:r.toLowerCase())}))||void 0===n?void 0:n.controlState)||0),z({field:"selectedConversation",value:t})}},[z,T,l,r]),(0,s.jsxs)(L.Provider,{value:{...h,handleNewConversation:M,handleCreateFolder:R,handleDeleteFolder:K,handleUpdateFolder:G,handleSelectConversation:D,handleUpdateConversation:J,handleUpdateConversationAll:H},children:[(0,s.jsxs)(d(),{children:[(0,s.jsx)("title",{children:"LlamaEdge Chat"}),(0,s.jsx)("meta",{name:"description",content:"ChatGPT but better."}),(0,s.jsx)("meta",{name:"viewport",content:"height=device-height ,width=device-width, initial-scale=1, user-scalable=no"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),P&&(0,s.jsxs)("main",{className:"flex h-screen w-screen flex-col text-sm text-white dark:text-white ".concat(I),children:[(0,s.jsx)("div",{className:"fixed top-0 w-full sm:hidden",children:(0,s.jsx)(e0,{selectedConversation:P,onNewConversation:M})}),(0,s.jsxs)("div",{className:"flex h-full w-full pt-[48px] sm:pt-0",children:[(0,s.jsx)(eQ,{}),(0,s.jsx)("div",{className:"flex flex-1",children:(0,s.jsx)(eg,{stopConversationRef:O})})]})]})]})};var e4=e2,e3=!0}},function(e){e.O(0,[879,349,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);